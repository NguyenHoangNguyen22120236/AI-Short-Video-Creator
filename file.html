<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Canvas Video with Text Effects</title>
  <style>
    canvas {
      border: 2px solid #444;
      background: #000;
      display: block;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<!-- Hidden video element -->
<video id="hiddenVideo" src="backend/output.mp4" style="display: none;" crossorigin="anonymous"></video>

<!-- Canvas preview -->
<canvas id="videoCanvas" width="384" height="512"></canvas>

<!-- Controls -->
<button id="playBtn">Play</button>
<button id="pauseBtn">Pause</button>

<script>
  const video = document.getElementById('hiddenVideo');
  const canvas = document.getElementById('videoCanvas');
  const ctx = canvas.getContext('2d');

  const playBtn = document.getElementById('playBtn');
  const pauseBtn = document.getElementById('pauseBtn');

  let isRendering = false;
  let overlayX = 0;
  let startTime = null;

  function renderFrame(timestamp) {
    if (!video.paused && !video.ended) {
      if (!startTime) startTime = timestamp;
      const elapsed = (timestamp - startTime) / 1000; // seconds

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw video
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // Animate position
      overlayX = 50 + Math.sin(elapsed * 2) * 100;

      // Animate opacity (fade in/out every 2s)
      const opacity = 0.5 + 0.5 * Math.sin(elapsed * Math.PI);

      // Animate scale
      const scale = 1 + 0.2 * Math.sin(elapsed * 3);

      // Save context to isolate transform
      ctx.save();

      // Set text style
      ctx.globalAlpha = opacity;
      ctx.translate(overlayX, 100);
      ctx.scale(scale, scale);

      ctx.font = '30px Arial';
      ctx.fillStyle = 'yellow';
      ctx.fillText('âœ¨ Dynamic Text Effect!', 0, 0);

      // Restore context
      ctx.restore();

      requestAnimationFrame(renderFrame);
    }
  }

  playBtn.addEventListener('click', () => {
    video.play();
    if (!isRendering) {
      isRendering = true;
      requestAnimationFrame(renderFrame);
    }
  });

  pauseBtn.addEventListener('click', () => {
    video.pause();
    isRendering = false;
  });

  // Initial draw
  video.addEventListener('loadeddata', () => {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    ctx.font = '30px Arial';
    ctx.fillStyle = 'red';
    ctx.fillText('ðŸŒŸ Ready to Play!', 20, 50);
  });
</script>

</body>
</html>